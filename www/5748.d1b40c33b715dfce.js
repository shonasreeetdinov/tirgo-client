"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[5748],{5748:(D,P,c)=>{c.r(P),c.d(P,{ProfilePageModule:()=>M});var U=c(6814),g=c(6223),h=c(7331),v=c(5356),d=c(5861),_=c(1869),E=c(6903),f=c(2726),m=function(o){return o.Prompt="PROMPT",o.Camera="CAMERA",o.Photos="PHOTOS",o}(m||{}),y=function(o){return o.Rear="REAR",o.Front="FRONT",o}(y||{}),b=function(o){return o.Uri="uri",o.Base64="base64",o.DataUrl="dataUrl",o}(b||{});class C extends f.Uw{getPhoto(i){var a=this;return(0,d.Z)(function*(){return new Promise(function(){var r=(0,d.Z)(function*(t,n){if(i.webUseInput||i.source===m.Photos)a.fileInputExperience(i,t,n);else if(i.source===m.Prompt){let u=document.querySelector("pwa-action-sheet");u||(u=document.createElement("pwa-action-sheet"),document.body.appendChild(u)),u.header=i.promptLabelHeader||"Photo",u.cancelable=!1,u.options=[{title:i.promptLabelPhoto||"From Photos"},{title:i.promptLabelPicture||"Take Picture"}],u.addEventListener("onSelection",function(){var l=(0,d.Z)(function*(s){0===s.detail?a.fileInputExperience(i,t,n):a.cameraExperience(i,t,n)});return function(s){return l.apply(this,arguments)}}())}else a.cameraExperience(i,t,n)});return function(t,n){return r.apply(this,arguments)}}())})()}pickImages(i){var a=this;return(0,d.Z)(function*(){return new Promise(function(){var r=(0,d.Z)(function*(t,n){a.multipleFileInputExperience(t,n)});return function(t,n){return r.apply(this,arguments)}}())})()}cameraExperience(i,a,r){var t=this;return(0,d.Z)(function*(){if(customElements.get("pwa-camera-modal")){const n=document.createElement("pwa-camera-modal");n.facingMode=i.direction===y.Front?"user":"environment",document.body.appendChild(n);try{yield n.componentOnReady(),n.addEventListener("onPhoto",function(){var u=(0,d.Z)(function*(l){const s=l.detail;null===s?r(new f.xz("User cancelled photos app")):s instanceof Error?r(s):a(yield t._getCameraPhoto(s,i)),n.dismiss(),document.body.removeChild(n)});return function(l){return u.apply(this,arguments)}}()),n.present()}catch{t.fileInputExperience(i,a,r)}}else console.error("Unable to load PWA Element 'pwa-camera-modal'. See the docs: https://capacitorjs.com/docs/web/pwa-elements."),t.fileInputExperience(i,a,r)})()}fileInputExperience(i,a,r){let t=document.querySelector("#_capacitor-camera-input");const n=()=>{var u;null===(u=t.parentNode)||void 0===u||u.removeChild(t)};t||(t=document.createElement("input"),t.id="_capacitor-camera-input",t.type="file",t.hidden=!0,document.body.appendChild(t),t.addEventListener("change",u=>{const l=t.files[0];let s="jpeg";if("image/png"===l.type?s="png":"image/gif"===l.type&&(s="gif"),"dataUrl"===i.resultType||"base64"===i.resultType){const p=new FileReader;p.addEventListener("load",()=>{if("dataUrl"===i.resultType)a({dataUrl:p.result,format:s});else if("base64"===i.resultType){const O=p.result.split(",")[1];a({base64String:O,format:s})}n()}),p.readAsDataURL(l)}else a({webPath:URL.createObjectURL(l),format:s}),n()}),t.addEventListener("cancel",u=>{r(new f.xz("User cancelled photos app")),n()})),t.accept="image/*",t.capture=!0,i.source===m.Photos||i.source===m.Prompt?t.removeAttribute("capture"):i.direction===y.Front?t.capture="user":i.direction===y.Rear&&(t.capture="environment"),t.click()}multipleFileInputExperience(i,a){let r=document.querySelector("#_capacitor-camera-input-multiple");const t=()=>{var n;null===(n=r.parentNode)||void 0===n||n.removeChild(r)};r||(r=document.createElement("input"),r.id="_capacitor-camera-input-multiple",r.type="file",r.hidden=!0,r.multiple=!0,document.body.appendChild(r),r.addEventListener("change",n=>{const u=[];for(let l=0;l<r.files.length;l++){const s=r.files[l];let p="jpeg";"image/png"===s.type?p="png":"image/gif"===s.type&&(p="gif"),u.push({webPath:URL.createObjectURL(s),format:p})}i({photos:u}),t()}),r.addEventListener("cancel",n=>{a(new f.xz("User cancelled photos app")),t()})),r.accept="image/*",r.click()}_getCameraPhoto(i,a){return new Promise((r,t)=>{const n=new FileReader,u=i.type.split("/")[1];"uri"===a.resultType?r({webPath:URL.createObjectURL(i),format:u,saved:!1}):(n.readAsDataURL(i),n.onloadend=()=>{const l=n.result;r("dataUrl"===a.resultType?{dataUrl:l,format:u,saved:!1}:{base64String:l.split(",")[1],format:u,saved:!1})},n.onerror=l=>{t(l)})})}checkPermissions(){var i=this;return(0,d.Z)(function*(){if(typeof navigator>"u"||!navigator.permissions)throw i.unavailable("Permissions API not available in this browser");try{return{camera:(yield window.navigator.permissions.query({name:"camera"})).state,photos:"granted"}}catch{throw i.unavailable("Camera permissions are not available in this browser")}})()}requestPermissions(){var i=this;return(0,d.Z)(function*(){throw i.unimplemented("Not implemented on web.")})()}pickLimitedLibraryPhotos(){var i=this;return(0,d.Z)(function*(){throw i.unavailable("Not implemented on web.")})()}getLimitedLibraryPhotos(){var i=this;return(0,d.Z)(function*(){throw i.unavailable("Not implemented on web.")})()}}new C;const A=(0,f.fo)("Camera",{web:()=>new C});var w=c(1493),e=c(2029),L=c(8720),T=c(2014),Z=c(3999);const x=[{path:"",component:(()=>{class o{constructor(a,r,t,n,u,l){this.navCtrl=a,this.authService=r,this.router=t,this.modalController=n,this.alert=u,this.storage=l,this.phone="",this.name="",this.country="\u0412\u044b\u0431\u0435\u0440\u0438\u0442\u0435",this.city="\u043e\u0440\u043e\u0434"}ngOnInit(){this.id=this.authService.currentUser?.id,this.phone=this.authService.currentUser?.phone,this.name=this.authService.currentUser?.name,this.country=this.authService.currentUser?.country,this.city=this.authService.currentUser?.city}ngAfterViewInit(){(0,E.lq)()}back(){this.navCtrl.back()}cropUpload(){var a=this;return(0,d.Z)(function*(){try{const r=yield A.getPhoto({quality:50,allowEditing:!1,resultType:b.Uri,source:m.Photos}),n=yield(yield fetch(r.webPath)).blob(),u=new FormData;u.append("file",n,`avatar_${(new Date).getTime()}.jpeg`),u.append("typeUser","client"),u.append("typeImage","avatar");const l=yield fetch(`${a.authService.serverApi}/users/uploadImage`,{method:"POST",headers:{Authorization:"Bearer "+_.$.jwt},body:u});if(l.ok){const s=yield l.json();s.status&&(a.authService.currentUser.avatar=s.file.preview)}else console.error("Upload failed")}catch(r){console.error(r)}})()}selectRegion(){var a=this;return(0,d.Z)(function*(){const r=yield a.modalController.create({component:w.B,showBackdrop:!0,breakpoints:[0,.9],initialBreakpoint:.9,presentingElement:yield a.modalController.getTop(),backdropDismiss:!0,cssClass:"modalCss",mode:"ios"});yield r.present();const{data:t}=yield r.onWillDismiss();if(console.log(t),t&&t.city)try{(yield a.authService.saveCityInfo(t.city.data).toPromise()).status&&(a.country=t.city.data.country,a.city=t.city.data.city,a.authService.currentUser.city=t.city.data.city,a.authService.currentUser.country=t.city.data.country)}catch(n){console.error(n)}})()}deleteModal(){var a=this;return(0,d.Z)(function*(){const r=yield a.alert.create({header:"\u0412\u044b \u0443\u0432\u0435\u0440\u0435\u043d\u044b?",message:"\u0412\u044b \u0443\u0432\u0435\u0440\u0435\u043d\u044b \u0447\u0442\u043e \u0445\u043e\u0442\u0438\u0442\u0435 \u0443\u0434\u0430\u043b\u0438\u0442\u044c \u0434\u0430\u043d\u043d\u043e\u0433\u043e \u0430\u043a\u043a\u0430\u0443\u043d\u0442?",cssClass:"customAlert",buttons:[{text:"\u041d\u0435\u0442",role:"cancel",cssClass:"secondary",handler:()=>{}},{text:"\u0414\u0430",handler:(t=(0,d.Z)(function*(){const n=yield a.authService.delUser(a.authService.currentUser.id).toPromise();n.status?(yield r.present(),yield a.storage.clear(),yield a.authService.logout(),yield a.router.navigate(["selectlanguage"],{replaceUrl:!0})):a.authService.alert("\u041e\u0448\u0438\u0431\u043a\u0430",n.error)}),function(){return t.apply(this,arguments)})}]});var t;yield r.present()})()}static#e=this.\u0275fac=function(r){return new(r||o)(e.Y36(L.SH),e.Y36(_.$),e.Y36(v.F0),e.Y36(h.IN),e.Y36(h.Br),e.Y36(T.K))};static#t=this.\u0275cmp=e.Xpm({type:o,selectors:[["app-profile"]],decls:44,vars:31,consts:[[1,"wrapper-fluid-header"],[1,"logo-wrap","personal-head"],[1,"top-back",3,"click"],["src","assets/img/arrow-left.svg","alt",""],[1,"ion-padding"],[1,"profile"],[1,"profile__photo",3,"click"],["alt","\u041a\u0430\u0440\u0442\u0438\u043d\u043a\u0430",3,"src"],[1,"profile__main","form"],[1,"profile__inputs"],[1,"form__group"],[1,"form__label"],[1,"form__input"],["type","text","readonly","",3,"placeholder","ngModel","ngModelChange"],["type","text","readonly","","mask","000 (000) 000 00 00",3,"placeholder","ngModel","ngModelChange"],[1,"form__input",3,"click"],["type","text","readonly","",3,"placeholder","value"],[1,"profile__text"],[1,"profile__btn","btn",3,"click"]],template:function(r,t){1&r&&(e.TgZ(0,"ion-header")(1,"div",0)(2,"div",1)(3,"button",2),e.NdJ("click",function(){return t.back()}),e._UZ(4,"img",3),e.qZA(),e.TgZ(5,"h2"),e._uU(6),e.ALo(7,"translate"),e.qZA(),e._UZ(8,"div"),e.qZA()()(),e.TgZ(9,"ion-content",4)(10,"main",5)(11,"div",6),e.NdJ("click",function(){return t.cropUpload()}),e._UZ(12,"img",7),e.TgZ(13,"span"),e._uU(14),e.ALo(15,"translate"),e.qZA()(),e.TgZ(16,"section",8)(17,"div",9)(18,"label",10)(19,"span",11),e._uU(20),e.ALo(21,"translate"),e.qZA(),e.TgZ(22,"div",12)(23,"input",13),e.NdJ("ngModelChange",function(u){return t.name=u}),e.ALo(24,"translate"),e.qZA()()(),e.TgZ(25,"label",10)(26,"span",11),e._uU(27),e.ALo(28,"translate"),e.qZA(),e.TgZ(29,"div",12)(30,"input",14),e.NdJ("ngModelChange",function(u){return t.phone=u}),e.ALo(31,"translate"),e.qZA()()(),e.TgZ(32,"label",10)(33,"span",11),e._uU(34),e.ALo(35,"translate"),e.qZA(),e.TgZ(36,"div",15),e.NdJ("click",function(){return t.selectRegion()}),e._UZ(37,"input",16),e.ALo(38,"translate"),e.qZA()(),e.TgZ(39,"p",17),e._uU(40),e.ALo(41,"translate"),e.qZA()(),e.TgZ(42,"button",18),e.NdJ("click",function(){return t.deleteModal()}),e._uU(43,"\u0423\u0434\u0430\u043b\u0438\u0442\u044c \u0430\u043a\u043a\u0430\u0443\u043d\u0442"),e.qZA()()()()),2&r&&(e.xp6(6),e.Oqu(e.lcZ(7,13,"\u041f\u0440\u043e\u0444\u0438\u043b\u044c")),e.xp6(6),e.Q6J("src",null==t.authService.currentUser?null:t.authService.currentUser.avatar,e.LSH),e.xp6(2),e.Oqu(e.lcZ(15,15,"\u0418\u0437\u043c\u0435\u043d\u0438\u0442\u044c \u0444\u043e\u0442\u043e")),e.xp6(6),e.Oqu(e.lcZ(21,17,"\u0423\u043a\u0430\u0436\u0438\u0442\u0435 \u0412\u0430\u0448\u0435 \u0424\u0418\u041e")),e.xp6(3),e.s9C("placeholder",e.lcZ(24,19,"\u0423\u043a\u0430\u0436\u0438\u0442\u0435 \u0412\u0430\u0448\u0435 \u0424\u0418\u041e")),e.Q6J("ngModel",t.name),e.xp6(4),e.Oqu(e.lcZ(28,21,"\u041d\u043e\u043c\u0435\u0440 \u0442\u0435\u043b\u0435\u0444\u043e\u043d\u0430")),e.xp6(3),e.s9C("placeholder",e.lcZ(31,23,"\u041d\u043e\u043c\u0435\u0440 \u0442\u0435\u043b\u0435\u0444\u043e\u043d\u0430")),e.Q6J("ngModel",t.phone),e.xp6(4),e.Oqu(e.lcZ(35,25,"\u0423\u043a\u0430\u0436\u0438\u0442\u0435 \u0432\u0430\u0448 \u0440\u0435\u0433\u0438\u043e\u043d")),e.xp6(3),e.s9C("placeholder",e.lcZ(38,27,"\u0423\u043a\u0430\u0436\u0438\u0442\u0435 \u0432\u0430\u0448 \u0440\u0435\u0433\u0438\u043e\u043d")),e.Q6J("value",t.country+" \u0433. "+t.city),e.xp6(3),e.hij(" ",e.lcZ(41,29,"\u0414\u043b\u044f \u0438\u0437\u043c\u0435\u043d\u0435\u043d\u0438\u044f \u043d\u043e\u043c\u0435\u0440 \u0442\u0435\u043b\u0435\u0444\u043e\u043d\u0430 \u0438 \u0438\u043c\u0435\u043d\u0438 \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044f \u043e\u0431\u0440\u0430\u0442\u0438\u0442\u0435\u0441\u044c \u0432 \u0441\u043b\u0443\u0436\u0431\u0443 \u043f\u043e\u0434\u0434\u0435\u0440\u0436\u043a\u0438.")," "))},dependencies:[g.Fj,g.JJ,g.On,h.W2,h.Gu,Z.X$],styles:[".profile[_ngcontent-%COMP%]{flex:1 1 auto;display:flex;flex-direction:column}.profile__main[_ngcontent-%COMP%]{display:grid;align-items:start;align-content:space-between;flex:1 1 auto}.profile__photo[_ngcontent-%COMP%]{margin:1.25rem 0;display:flex;align-items:center}.profile__photo[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:5.625rem;height:5.625rem;object-fit:cover;border-radius:50%;margin-right:1.25rem}.profile__photo[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{color:#403c61;font-weight:600}.profile__text[_ngcontent-%COMP%]{color:#47484f;padding:1.25rem 0}"]})}return o})()}];let S=(()=>{class o{static#e=this.\u0275fac=function(r){return new(r||o)};static#t=this.\u0275mod=e.oAB({type:o});static#r=this.\u0275inj=e.cJS({imports:[v.Bz.forChild(x),v.Bz]})}return o})(),M=(()=>{class o{static#e=this.\u0275fac=function(r){return new(r||o)};static#t=this.\u0275mod=e.oAB({type:o});static#r=this.\u0275inj=e.cJS({providers:[Storage],imports:[U.ez,g.u5,h.Pc,S,Z.aw]})}return o})()}}]);